<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Cocktail Manager</title>
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
</head>
<body class="bg-gray-50 text-gray-900">
  <nav class="bg-white border-b border-gray-200 px-4 py-3 mb-4">
    <div class="flex space-x-6 font-semibold">
      <a href="/cocktail-manager.html" class="text-blue-600 underline">Cocktails</a>
      <a href="#" class="hover:underline">Training</a>
      <a href="#" class="hover:underline">Admin</a>
      <a href="#" class="hover:underline">Login</a>
    </div>
  </nav>

  <div class="max-w-4xl mx-auto px-4">
    <h1 class="text-2xl font-bold mb-4">Cocktail Card Manager</h1>
    <div class="flex flex-wrap gap-2 items-center mb-4">
      <input id="search" type="text" placeholder="Search cocktails..." class="border rounded px-3 py-1 w-60">
      <select id="sort" class="border rounded px-2 py-1">
        <option value="az">Sort: A–Z</option>
        <option value="za">Sort: Z–A</option>
      </select>
    </div>
    <div id="cards" class="space-y-4"></div>
    <p id="error" class="text-red-600 mt-4 hidden">Error loading cocktail data. Check server logs or Drive file format.</p>
  </div>

  <script>
    async function loadCocktails() {
      try {
        const res = await fetch("/.netlify/functions/load-cocktail-data")
        const result = await res.json()
        const data = JSON.parse(result.body)

        if (!Array.isArray(data)) throw new Error("Invalid data array")

        const container = document.getElementById("cards")
        const errorMsg = document.getElementById("error")

        // Sort
        const sortOrder = document.getElementById("sort").value
        data.sort((a, b) => {
          const nameA = a.title?.toLowerCase?.() || ""
          const nameB = b.title?.toLowerCase?.() || ""
          return sortOrder === "az" ? nameA.localeCompare(nameB) : nameB.localeCompare(nameA)
        })

        // Render
        const query = document.getElementById("search").value.toLowerCase()
        const filtered = data.filter(c => c.title?.toLowerCase().includes(query))

        container.innerHTML = filtered.map(c => `
          <div class="bg-white p-4 rounded shadow">
            <h2 class="text-xl font-bold mb-2">${c.title || "Untitled Cocktail"}</h2>
            <p><strong>Ingredients:</strong> ${c.ingredients || "N/A"}</p>
            <p><strong>Glassware:</strong> ${c.glassware || "N/A"}</p>
            <p><strong>Method:</strong> ${c.method || "N/A"}</p>
            <p><strong>Pro Tip:</strong> ${c.pro_tip || "N/A"}</p>
            <p><strong>Did You Know:</strong> ${c.did_you_know || "N/A"}</p>
            <a href="/cocktail-editor.html?slug=${c.slug || ""}" class="mt-2 inline-block px-3 py-1 bg-blue-600 text-white rounded">Edit</a>
          </div>
        `).join("")

        errorMsg.classList.add("hidden")
      } catch (err) {
        document.getElementById("error").classList.remove("hidden")
        console.error("Load error:", err)
      }
    }

    document.getElementById("search").addEventListener("input", loadCocktails)
    document.getElementById("sort").addEventListener("change", loadCocktails)
    window.addEventListener("DOMContentLoaded", loadCocktails)
  </script>
</body>
</html>